## 理解高并发中的协程

协程是比线程更小的一种执行单元，你可以认为是轻量级的线程。

之所以说轻：其中一方面的原因是协程所持有的栈比线程要小很多，java当中会为每个线程分配1M左右的栈空间，而协程可能只有几十或者几百K，栈主要用来保存函数参数、局部变量和返回地址等信息。

### 协程的切换到底为什么很廉价？

关于这个问题，我们回顾一下线程切换的过程：
- 线程在切换过程中，需要把cpu中寄存器的数据都要保存起来，然后读取另一个线程的数据
- cpu的高速缓存中的数据可能随时失效
- 线程的切换涉及到用户态到内核态的转换

实际上协程的切换之所以快的原因我认为主要是：

- 在切换过程中，寄存器保存和加载的数据量比较小
- 高速缓存可以加以利用
- 没有涉及到用户态到内核态到转换